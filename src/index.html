<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video call test</title>
</head>

<body>
  <video width="320" height="240"></video>
  <button>Stop</button>
  <script src="./simplepeer.min.js"></script>
  <script>
    navigator.mediaDevices.getUserMedia({
      video: true,
      audio: true
    }).then(gotMedia).catch(() => { })

    function gotMedia(stream) {
      var peer1 = new SimplePeer({ initiator: true, stream: stream })
      var peer2 = new SimplePeer()

      peer1.on('signal', data => {
        peer2.signal(data)
      })

      peer2.on('signal', data => {
        peer1.signal(data)
      })

      peer2.on('stream', stream => {
        // got remote video stream, now let's show it in a video tag
        var video = document.querySelector('video')

        if ('srcObject' in video) {
          video.srcObject = stream
        } else {
          video.src = window.URL.createObjectURL(stream) // for older browsers
        }

        video.play()
      })

      document.querySelector('button').addEventListener('click', ev => {
        ev.preventDefault()
        var video = document.querySelector('video')
        video.src = ''
      })
    }
  </script>
</body>

</html>